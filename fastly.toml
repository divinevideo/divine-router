# ABOUTME: Fastly Compute configuration for divine-router
# ABOUTME: Routes wildcard subdomains to appropriate backends

authors = ["Divine Video"]
description = "Edge router for divine.video wildcard subdomains"
language = "rust"
manifest_version = 3
name = "divine-router"
service_id = "76fTayX6mBKa8faLeZ1fet"

[local_server]

  [local_server.backends]

    [local_server.backends.main_site]
      url = "https://dvines.org"

    [local_server.backends.username_handler]
      url = "https://dvines.org"

  [local_server.kv_stores]

    [local_server.kv_stores.usernames]
      file = "kv_usernames.json"
      format = "json"

[scripts]
  build = "cargo build --profile release --target wasm32-wasip1"

[setup]

  [setup.backends]

    [setup.backends.main_site]
      address = "dvines.org"
      port = 443

    [setup.backends.username_handler]
      address = "dvines.org"
      port = 443

  [setup.kv_stores]

    [setup.kv_stores.usernames]
